<h1>Maneuver</h1>
<h2 id= "header2">Floor 1</h2>

<body onload="setup()"></body>
<script src="Mishmash.js"></script>

<script>
    function setup(){
        mapData = new GameMap(8, 8);  
        mapData.add_enemy(spider_tile());
        mapData.display();
        deck = make_starting_deck();
        deck.display_hand(document.getElementById("handDisplay"));
    }

    function describe(description){
        document.getElementById("header3").innerText = description;
    }

    function clear_tb(element_id){
        while(document.getElementById(element_id).rows.length > 0){
            document.getElementById(element_id).deleteRow(0);
        }
    }

    function prep_move(move, hand_pos){
        clear_tb("moveButtons");
        var row = document.createElement('tr');
        row.id = "buttons";
        for(var i = 0; i < move.descriptions.length; ++i){
            var cell = document.createElement('input');
            cell.type = 'button'
			cell.name = move.descriptions[i];
            cell.value = move.descriptions[i];
            var act = function(behavior, hand_pos){return function(){action(behavior, hand_pos)}};
            cell.onclick = act(move.behavior[i], hand_pos);
			row.append(cell);
        }
        document.getElementById("moveButtons").append(row);
    }

    function action(behavior, hand_pos){
        try{
            for(var i = 0; i < behavior.length; ++i){
                if(behavior[i][0] === "attack"){
                    mapData.player_attack(behavior[i][1], behavior[i][2]);
                }
                else if(behavior[i][0] === "move"){
                    mapData.player_move(behavior[i][1], behavior[i][2]);
                }
                else{
                    throw new Error("Invalid Action Type");
                }
            }
            deck.discard(hand_pos);
            clear_tb("moveButtons");
            deck.display_hand(document.getElementById("handDisplay"));
            mapData.display();
            mapData.enemy_turn();
            mapData.display();
        }
        catch (error){
            var m = error.message;
            if(m === 'floor complete'){
                var floor = mapData.erase(mapData.player_health());
                for(var i = 0; i < floor * 2;){
                    var choice = Math.floor(Math.random() * enemy_list.length);
                    var new_enemy = enemy_list[choice]();
                    mapData.add_enemy(new_enemy);
                    i += new_enemy.difficulty;
                }
                document.getElementById('header2').innerText = 'Floor ' + floor;
                deck.deal();
                mapData.display();
                deck.display_hand(document.getElementById("handDisplay"));
            }
            else if(m === 'game over'){
                mapData.display();
                clear_tb("handDisplay");
                describe("Game Over");
            }
            else{
                console.log(m)
            }
        }
    }
</script>

<table id="mapDisplay"></table>
<table id="handDisplay"></table>
<table id="moveButtons"></table>
<h3 id= "header3">Welcome to the dungeon</h3>